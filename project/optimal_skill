-- skills with top demand and top salary for data analyst
with skills_demand AS(
    SELECT
    skills_dim.skill_id,
       skills_dim.skills,
       count(skills_job_dim.job_id) as skill_count
       FROM
       job_postings_fact
       INNER JOIN skills_job_dim on job_postings_fact.job_id = skills_job_dim.job_id
       INNER JOIN skills_dim ON skills_dim.skill_id=skills_job_dim.skill_id
       WHERE job_title_short = 'Data Analyst' AND job_work_from_home = true AND 
       salary_year_avg IS NOT NULL
       
       GROUP BY skills_dim.skill_id
       
), average_salary AS(
    SELECT
    skills_job_dim.skill_id, 
       ROUND(AVG(salary_year_avg),0) as avg_salary
       FROM
       job_postings_fact
       INNER JOIN skills_job_dim on job_postings_fact.job_id = skills_job_dim.job_id
       INNER JOIN skills_dim ON skills_dim.skill_id=skills_job_dim.skill_id
       WHERE 
       job_title_short = 'Data Analyst'AND job_work_from_home = true
       and salary_year_avg IS NOT NULL 

       GROUP BY skills_job_dim.skill_id
      
)
 select 
 skills_demand.skill_id,
 skills_demand.skills,
 skill_count,
 avg_salary
 FROM skills_demand
 inner join average_salary on skills_demand.skill_id=average_salary.skill_id






